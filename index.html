<!doctype html>
<html lang="en">
<html>
    <head>
        <meta charset="utf-8">
   <style>
      body { margin: 0 }
      canvas { 
        width:100%;
        height:100%;
        position:absolute; 
      }
    </style>  
  </head>
  <body>
    <canvas></canvas>
    <script>
      'use strict'
      const canvas = document.querySelector( 'canvas' )
      const ctx = canvas.getContext( '2d' )
     
    window.AudioContext = window.AudioContext||window.webkitAudioContext;
    var context = new AudioContext();
      
     /* const aud = new AudioContext()
        const osc = aud.createOscillator()*/

/*
// square, sine, triangle, sawtooth...
  osc.type = 'square'

  // set frequency value based on argument frequency
  osc.frequency.value = 220

  osc.connect(aud.destination)
  osc.start(0)
   osc.s(aud.currentTime + 2)
// make a function to play a note with a specified
// frequency and duration
const playNote = function() {


 // osc.start()
setInterval(function() { 
    osc.start()
    osc.stop(aud.currentTime + 2)
    }, 5000)
  // remove the node two seconds from
  // the current audio time
 // osc.stop(aud.currentTime + duration)
}


// 220 Hz, 2 seconds
playNote() 
*/
        
/*var RhythmSample = {
};

RhythmSample.play = function() {
  function playSound(buffer, time) {
    var source = context.createBufferSource();
    source.buffer = buffer;
    source.connect(context.destination);
    if (!source.start)
      source.start = source.noteOn;
    source.start(time);
  }

  var kick = BUFFERS.kick;
  var snare = BUFFERS.snare;
  var hihat = BUFFERS.hihat;

  // We'll start playing the rhythm 100 milliseconds from "now"
  var startTime = context.currentTime + 0.100;
  var tempo = 80; // BPM (beats per minute)
  var eighthNoteTime = (60 / tempo) / 2;

  // Play 2 bars of the following:
  for (var bar = 0; bar < 2; bar++) {
    var time = startTime + bar * 8 * eighthNoteTime;
    // Play the bass (kick) drum on beats 1, 5
    playSound(kick, time);
    playSound(kick, time + 4 * eighthNoteTime);

    // Play the snare drum on beats 3, 7
    playSound(snare, time + 2 * eighthNoteTime);
    playSound(snare, time + 6 * eighthNoteTime);

    // Play the hi-hat every eighthh note.
    for (var i = 0; i < 8; ++i) {
      playSound(hihat, time + i * eighthNoteTime);
    }
  }
};*/
        
    
        
    function playSound(){
        
        function playBeat(buffer, timer){
            var source = context.createBufferSource();
            source.buffer = buffer;
            source.connect(context.destination);
            if(!source.start)
                source.start = source.noteOn;
                source.start(time);
        }
        
        var beat = BUFFERS.kick;
        var start = context.currentTime + .100;
        var tempo = 80;
        var eightNoteTime = (60/ tempo) / 2;
        
        for (var bar = 0; bar < 2; bar++) {
            var time = start + bar * 8 * eightNoteTime;
                
            playBeat(beat, time);
            playBeat(beat, time + 6 * eightNoteTime );
            console.log('beat');
        }
        
    
        
    }
        
function Kick(context) {
	this.context = context;
};

Kick.prototype.setup = function() {
	this.osc = this.context.createOscillator();
	this.gain = this.context.createGain();
	this.osc.connect(this.gain);
	this.gain.connect(this.context.destination)
};

Kick.prototype.trigger = function(time) {
	this.setup();

	this.osc.frequency.setValueAtTime(150, time);
	this.gain.gain.setValueAtTime(1, time);

	this.osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.5);
	this.gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);

	this.osc.start(time);
    console.log('beat')
	this.osc.stop(time + 0.5);
    
    grid[200][200] = 1
};
        
    var kick = new Kick(context);
        var now = context.currentTime;
        
        //var beat = BUFFERS.kick;
        
      

      const width = 400
      const height = 400

      let grid = []
      let temp = []

      canvas.width = width
      canvas.height = height

      for( let y = 0; y < height; y++ ) {
        grid[ y ] = []
        temp[ y ] = [] 

        for( let x = 0; x < width; x++ ) {
          grid[ y ][ x ] = Math.round( Math.random() )
          temp[ y ][ x ] = 0 
        }
      }
        //console.log("random")
        
  /*      let stateChanger = function(cellOne, cellTwo, cellThree){
          
            let current = (cellOne,cellTwo,cellThree)
            
            if(cellOne == 0){
                if(cellTwo == 0 && cellThree == 0){
                    return 0
                }
                else if(cellTwo == 1 && cellThree == 0){
                    return 0
                }
                else {
                    return 1
                }

            }
            else{
                if(cellTwo == 0 && cellThree == 0){
                    return 1
                }
                else if(cellTwo == 1 && cellThree == 0){
                    return 1
                }
                else{
                    return 0
                }
            }
      }*/

      let runAutomata = function() {
        // loop through every cell
        // look at cell neighbors and count the live ones
        // determine next cell state based on neighbor count
        // set temp[y][x] -> new cell state
        if (grid == undefined){  //incase of error
               for( let y = 0; y < height; y++ ) {
        grid[ y ] = []
        temp[ y ] = [] 

        for( let x = 0; x < width; x++ ) {
          grid[ y ][ x ] = Math.round( Math.random() )
          temp[ y ][ x ] = 0 
        }
        }
           // console.log(undefined) //error testing
        }
        else{
        for( let y = 0; y < height; y++ ) {
        
        for( let x = 0; x < width; x++ ) {
            

            let liveCount = 0
   
            //Check which neightbors are alive and are not 
            let tL, tM, tR, mL ,mR ,bL , bM ,bR 
            //console.log(y,x)  //error checking  
            if(y == 0){
                if(x == 0){
                    
                 
                     tM = grid[height-1][x] //topMiddle
                   
                     mL = grid[y][width-1] //MiddleLeft
                     mR =grid[y][x+1] //MiddleRight
              
                     bM =grid[y+1][x] //BottomMiddle
                    
                }
                else if(x == width){
                   
                     tM = grid[height-1][x] //topMiddle
                    
                     mL = grid[y][x-1] //MiddleLeft
                     mR =grid[y][0] //MiddleRight
                   
                     bM =grid[y+1][x] //BottomMiddle
                
                }
                else{
        
                     tM = grid[height-1][x] //topMiddle
             
                     mL = grid[y][x-1] //MiddleLeft
                     mR =grid[y][x+1] //MiddleRight
                   
                     bM =grid[y+1][x] //BottomMiddle
                  
                }
            }
            else if(y == (width-1)){
                if(x == 0){
              
                     tM = grid[y-1][x] //topMiddle
                
                     mL = grid[y][width-1] //MiddleLeft
                     mR =grid[y][x+1] //MiddleRight
                 
                     bM =grid[0][x] //BottomMiddle
              
                }
                else if(x==width){
            
                     tM = grid[y-1][x] //topMiddle
                
                     mL = grid[y][x-1] //MiddleLeft
                     mR =grid[y][0] //MiddleRight
                
                     bM =grid[0][x] //BottomMiddle
                 
                }
                else{
               
                     tM = grid[y-1][x] //topMiddle
             
                     mL = grid[y][x-1] //MiddleLeft
                     mR =grid[y][x+1] //MiddleRight
                 
                     bM =grid[0][x] //BottomMiddle
                
                }
                
            }
            else if(x == 0){
                  
                     tM = grid[y-1][x] //topMiddle
                    
                     mL = grid[y][width-1] //MiddleLeft
                     mR =grid[y][x+1] //MiddleRight
                 
                     bM =grid[y+1][x] //BottomMiddle
         
            }
            else if(x == width){
                     tM = grid[y-1][x] //topMiddle

                     mL = grid[y][x-1] //MiddleLeft
                     mR =grid[y][0] //MiddleRight
            
                     bM =grid[y+1][x] //BottomMiddle
                
            }

            else{
          
                     tM = grid[y-1][x] //topMiddle
               
                     mL = grid[y][x-1] //MiddleLeft
                     mR =grid[y][x+1] //MiddleRight
      
                     bM =grid[y-1][x] //BottomMiddle
       
            }
            
            //Does the Cell live or become Alive
            liveCount =  tM + mL +mR+ bM //Add up the population
            if(liveCount >= 3){ //Dies if over populated or underpopulated
                temp[x][y] = 0
            }
            else{ //Become Alive due to repopulation or continues to live
                temp[x][y]= 1
            }
        }
            
        }

        }  

        // after for loop, swap grid and temp arrays
        let swap = grid
        grid = temp
        temp = swap
         }
      
      let count = 0 
      let draw = function() {
        runAutomata()
  
        ctx.fillStyle = '#333232'
        ctx.fillRect( 0,0,width,height )
        ctx.fillStyle = '#C73E1D'


        for( let y = 0; y < height; y++ ) {
          for( let x = 0; x < width; x++ ) {
            if( grid[ y ][ x ] === 1 ) {
              ctx.fillRect( x,y,1,1 ) 
            } 
          }
        }

        window.requestAnimationFrame( draw )
      }
         window.setInterval(kick.trigger(now), 2000);
     window.setInterval(kick.trigger(now), 5000); 
    window.setInterval(kick.trigger(now), 8000);
        //playSound();
      window.requestAnimationFrame( draw )
      
    </script>
  </body>
</html>